name: Update reference every 8 hours
on:
    schedule:
        - cron: "21 */8 * * *" # 定时任务
    workflow_dispatch: # 手动运行

env: # 设置环境变量
    TZ: Asia/Shanghai # 时区（设置时区可使页面中的`最近更新时间`使用时区时间）

jobs:
    build-static-website:
        runs-on: ubuntu-latest
        steps:
            - name: 拉取最新代码
              uses: actions/checkout@v5
              with:
                  ref: "main"
                  repository: "jaywcjlove/reference"

            - name: 修改.env 文件和Readme.md
              run: |
                  echo -e 'REF_URL=https://refs.linyuanshi.me/\nREF_LABEL=网站首页' > .env

            - name: 编译静态文件
              run: |
                  npm install
                  npm run build

            - name: Login to DockerHub
              uses: docker/login-action@v2
              with:
                  username: ${{ secrets.DOCKER_HUB_USERNAME }}
                  password: ${{ secrets.DOCKER_HUB_ACCESS_TOKEN }}

            - name: Set up Docker Buildx
              uses: docker/setup-buildx-action@v3

            - run: docker buildx prune

            - name: Build and push image:latest
              uses: docker/build-push-action@v5
              with:
                  push: true
                  context: .
                  platforms: linux/amd64
                  tags: mikeyxxt/reference:latest
